<app-admin-header (toggleSidebar)="toggleSidebar()"></app-admin-header>
<app-sidebar [isOpen]="sidebarOpen"></app-sidebar>

<!-- üî• TOAST GLOBAL DO ADMIN -->
<app-toast [message]="alertMessage" [show]="showAlert"></app-toast>

<!-- üî• POPUP DE CONFIRMA√á√ÉO DE REJEI√á√ÉO -->
<div class="popup-backdrop" *ngIf="popupRejectVisible">
  <div class="popup-box">
    <h3>Confirmar Rejei√ß√£o?</h3>

    <p>
      Voc√™ est√° prestes a <b>recusar e deletar</b> o usu√°rio:
      <span class="user-tag">{{ popupRejectUser }}</span>
    </p>

    <p class="warning">Esta a√ß√£o √© permanente e n√£o pode ser desfeita.</p>

    <div class="popup-actions">
      <button class="btn-cancel" (click)="closeRejectPopup()">Cancelar</button>
      <button class="btn-confirm" (click)="confirmReject()">Sim, deletar</button>
    </div>
  </div>
</div>

<div class="main-layout" [class.sidebar-open]="sidebarOpen">
  <main class="content">
    <h2>Lista de Usu√°rios Pendentes</h2>

    <!-- üî• A√á√ïES EM GRUPO (exibidas apenas se houver usu√°rios) -->
  <div class="bulk-actions" *ngIf="usuarios.length > 0">
    <button class="btn-approve" (click)="aprovarSelecionados()">
    Aprovar Selecionados
  </button>

  <button class="btn-reject" (click)="recusarSelecionados()">
    Recusar Selecionados
  </button>
</div>


    <!-- üî• MENSAGEM QUANDO N√ÉO EXISTEM PENDENTES -->
    <div class="empty-box" *ngIf="usuarios.length === 0">
      <p>Nenhum usu√°rio pendente para aprova√ß√£o.</p>
    </div>

    <!-- üî• TABELA SOMENTE QUANDO EXISTEM USU√ÅRIOS -->
    <div class="table-container" *ngIf="usuarios.length > 0">
      <table>
        <thead>
          <tr>
            <th>
              <input
                type="checkbox"
                [checked]="allSelected"
                (change)="toggleSelectAll($event)"
              />
            </th>

            <th>Username</th>
            <th>Status</th>
            <th>Nome</th>
            <th>Email</th>
            <th>CPF</th>
            <th>Data Nasc.</th>
            <th>Telefone</th>
            <th>Endere√ßo</th>
            <th>CEP</th>
            <th>Cadastro</th>
            <th>Sexo</th>
            <th>Doc.</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let user of usuarios">
            <td>
              <input
                type="checkbox"
                [(ngModel)]="user.selected"
                (change)="updateSelectAllState()"
              />
            </td>

            <td>{{ user.username }}</td>

            <td>
              <span
                [ngStyle]="{
                  color:
                    user.status === 'ATIVO'
                      ? 'green'
                      : user.status === 'PENDENTE'
                      ? 'goldenrod'
                      : 'red'
                }"
              >
                {{ user.status }}
              </span>
            </td>

            <td>{{ user.nome }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.cpf }}</td>
            <td>{{ formatDate(user.dtNascimento) }}</td>
            <td>{{ user.telefone }}</td>
            <td>{{ user.endereco }}</td>
            <td>{{ user.cep }}</td>
            <td>{{ user.dtCadastro | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ user.sexo }}</td>
            <td>{{ user.urlDocumento || '-' }}</td>

            <td class="actions">
              <button
                class="btn-single-approve"
                (click)="aprovarUsuario(user.username)"
              >
                ‚úî
              </button>
              <button 
                class="btn-single-reject"
                (click)="openRejectPopup(user.username)"
              >
                ‚úñ
              </button>

            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
