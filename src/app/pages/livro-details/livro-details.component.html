<app-menu></app-menu>

<app-toast 
  [message]="toastMessage" 
  [show]="toastShow">
</app-toast>

<main class="page-wrapper" *ngIf="!loading(); else loadingTpl">
  <section class="book-section">

    <!-- LEFT -->
    <div class="left">
      <img [src]="book().cover" alt="Capa do livro" class="cover" />
    </div>

    <!-- RIGHT -->
    <div class="right">

      <h1 class="book-title">{{ book().title }}</h1>

      <p><strong>Autor Principal:</strong> {{ book().author }}</p>
      <p><strong>Editora:</strong> {{ book().publisher }}</p>
      <p><strong>Obra:</strong> {{ book().obra }}</p>
      <p><strong>Tema Principal:</strong> {{ book().theme }}</p>
      <p><strong>Ano de lançamento:</strong> {{ book().anoLancamento }}</p>

      <p><strong>Status:</strong>
        <span 
          class="status-chip">
          {{ statusFinal() }}
        </span>
      </p>

      <div class="list-box" *ngIf="book().autores?.length">
        <strong>Autores:</strong>
        <span class="chip" *ngFor="let a of book().autores">{{ a }}</span>
      </div>

      <div class="list-box" *ngIf="book().temas?.length">
        <strong>Temas:</strong>
        <span class="chip-alt" *ngFor="let t of book().temas">{{ t }}</span>
      </div>

      <div class="list-box" *ngIf="book().tags?.length">
        <strong>Tags:</strong>
        <span class="chip" *ngFor="let t of book().tags">#{{ t }}</span>
      </div>

      <p><strong>Descrição:</strong></p>
      <p class="description">
        {{ truncatedDescription() }}
        <a *ngIf="book().description?.length > 450"
           (click)="toggleDescription()" class="read-more">
          {{ showFullDescription() ? 'Ler menos' : 'Ler mais' }}
        </a>
      </p>

      <p class="stock" *ngIf="!livroObtido()">
        Quantidade disponível: {{ book().stock }}
      </p>

      <div>

        <!-- PEGAR LIVRO -->
        <button 
          *ngIf="!livroObtido() && !livroReservado() && book().stock > 0" 
          class="btn-obter" 
          (click)="obterLivro()">
          OBTER LIVRO
        </button>

        <!-- RESERVAR LIVRO (Esgotado) -->
        <div *ngIf="!livroObtido() && !livroReservado() && book().stock === 0">

          <button
            class="btn-reservar"
            (click)="reservarLivro()">
            RESERVAR LIVRO
          </button>

          <p style="margin-top:8px;color:#ffb100;font-size:14px;">
            Todos os exemplares estão emprestados.<br>
            Você pode realizar uma reserva.
          </p>
        </div>

        <!-- USUÁRIO JÁ ESTÁ NA FILA -->
        <div *ngIf="livroReservado()" style="margin-top:10px;">
          <p style="color:#ffb100;font-size:14px;">
            Você está na lista de espera para este livro.
          </p>

          <button class="btn-devolver" (click)="cancelarReserva()">
            CANCELAR RESERVA
          </button>
        </div>

        <!-- LER AGORA -->
        <a 
          *ngIf="livroObtido()" 
          class="btn-obter"
          style="color:#000;text-align:center;display:inline-block;text-decoration:none;margin-right:10px"
          [routerLink]="['/livros/ler', book().id]">
          LER AGORA
        </a>

        <!-- DEVOLVER LIVRO -->
        <button
          *ngIf="livroObtido()"
          class="btn-devolver"
          (click)="devolverLivro()">
          DEVOLVER LIVRO
        </button>

      </div>

    </div>

  </section>
</main>

<ng-template #loadingTpl>
  <p style="color:white;text-align:center;margin-top:50px">
    Carregando detalhes do livro...
  </p>
</ng-template>
