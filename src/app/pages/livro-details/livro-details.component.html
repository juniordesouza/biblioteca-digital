<!-- src/app/pages/livro-details/livro-details.component.html -->
<app-menu></app-menu>

<app-toast 
  [message]="toastMessage" 
  [show]="toastShow">
</app-toast>

<main class="page-wrapper" *ngIf="!loading(); else loadingTpl">
  <section class="book-section">

    <!-- LEFT -->
    <div class="left">
      <img [src]="book().cover" alt="Capa do livro" class="cover" />
    </div>

    <!-- RIGHT -->
    <div class="right">

      <h1 class="book-title">{{ book().title }}</h1>

      <p><strong>Autor Principal:</strong> {{ book().author }}</p>
      <p><strong>Editora:</strong> {{ book().publisher }}</p>
      <p><strong>Obra:</strong> {{ book().obra }}</p>
      <p><strong>Tema Principal:</strong> {{ book().theme }}</p>
      <p><strong>Ano de lanﾃｧamento:</strong> {{ book().anoLancamento }}</p>

      <p><strong>Status:</strong>
        <span 
          class="status-chip" 
          [class.status-ok]="book().status === 'DISPONIVEL'"
          [class.status-other]="book().status !== 'DISPONIVEL'">
          {{ book().status }}
        </span>
      </p>

      <div class="list-box" *ngIf="book().autores?.length">
        <strong style="width:100%">Autores:</strong>
        <span class="chip" *ngFor="let a of book().autores">{{ a }}</span>
      </div>

      <div class="list-box" *ngIf="book().temas?.length">
        <strong style="width:100%">Temas:</strong>
        <span class="chip-alt" *ngFor="let t of book().temas">{{ t }}</span>
      </div>

      <div class="list-box" *ngIf="book().tags?.length">
        <strong style="width:100%">Tags:</strong>
        <span class="chip" *ngFor="let t of book().tags">#{{ t }}</span>
      </div>

      <p><strong>Descriﾃｧﾃ｣o:</strong></p>
      <p class="description">
        {{ truncatedDescription() }}
        <ng-container *ngIf="book().description?.length > 450">
          <a (click)="toggleDescription()" class="read-more">
            {{ showFullDescription() ? 'Ler menos' : 'Ler mais' }}
          </a>
        </ng-container>
      </p>

      <p class="stock" *ngIf="!livroObtido()">
        Quantidade disponﾃｭvel: {{ book().stock }}
      </p>

      <div>

        <!-- 沒 BOTﾃグ DE PEGAR LIVRO (sﾃｳ aparece se houver unidades disponﾃｭveis) -->
        <button 
          *ngIf="!livroObtido() && book().stock > 0" 
          class="btn-obter" 
          (click)="obterLivro()">
          OBTER LIVRO
        </button>

        <!-- 沒 BOTﾃグ DE RESERVAR (se nﾃ｣o houver unidades + status != DISPONIVEL) -->
        <button
          *ngIf="!livroObtido() && book().stock === 0"
          class="btn-reservar"
          (click)="reservarLivro()">
          RESERVAR LIVRO
        </button>

        <!-- MENSAGEM DE INFO -->
        <p 
          *ngIf="!livroObtido() && book().stock === 0"
          style="margin-top:8px;color:#ffb100;font-size:14px;">
          Todos os exemplares estﾃ｣o emprestados.  
          Vocﾃｪ pode realizar uma reserva.
        </p>

        <!-- 沒 BOTﾃグ LER AGORA -->
        <a 
          *ngIf="livroObtido()" 
          class="btn-obter"
          style="color:#000;text-align:center;display:inline-block;text-decoration:none;margin-right:10px"
          [routerLink]="['/livros/ler', book().id]">
          LER AGORA
        </a>

        <!-- 沐･ BOTﾃグ DEVOLVER LIVRO -->
        <button
          *ngIf="livroObtido()"
          class="btn-devolver"
          (click)="devolverLivro()">
          DEVOLVER LIVRO
        </button>

      </div>

    </div>

  </section>
</main>

<ng-template #loadingTpl>
  <p style="color:white;text-align:center;margin-top:50px">
    Carregando detalhes do livro...
  </p>
</ng-template>
